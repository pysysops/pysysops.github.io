<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Easy Infrastructure Testing with Goss</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="http://www.pysysops.com/favicon.ico">

    <link rel="stylesheet" type="text/css" href="//www.pysysops.com/themes/casper/assets/css/screen.css?v=1485532747783" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />

    <link rel="canonical" href="http://www.pysysops.com/2017/01/10/Easy-Infrastructure-Testing-with-Goss.html" />
    <meta name="referrer" content="origin" />
    
    <meta property="og:site_name" content="Tim Birkett " />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Easy Infrastructure Testing with Goss" />
    <meta property="og:description" content="In the world of infrastructure; new servers, VMs, containers or applications are often manually validated by a human. Some form of build document or checkbox exercise takes place to confirm that the piece of infrastructure is ready for use. Even with configuration management, mistakes happen and humans make mistakes (damn" />
    <meta property="og:url" content="http://www.pysysops.com/2017/01/10/Easy-Infrastructure-Testing-with-Goss.html" />
    <meta property="article:tag" content="Configuration Management" />
    <meta property="article:tag" content=" Testing" />
    <meta property="article:tag" content=" Security" />
    <meta property="article:tag" content=" Monitoring" />
    <meta property="article:tag" content=" goss" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Easy Infrastructure Testing with Goss" />
    <meta name="twitter:description" content="In the world of infrastructure; new servers, VMs, containers or applications are often manually validated by a human. Some form of build document or checkbox exercise takes place to confirm that the piece of infrastructure is ready for use. Even with configuration management, mistakes happen and humans make mistakes (damn" />
    <meta name="twitter:url" content="http://www.pysysops.com/2017/01/10/Easy-Infrastructure-Testing-with-Goss.html" />
    
    <script type="application/ld+json">
null
    </script>

    <meta name="generator" content="HubPress" />
    <link rel="alternate" type="application/rss+xml" title="Tim Birkett " href="http://www.pysysops.com/rss/" />
</head>
<body class="post-template tag-Configuration-Management tag-Testing tag-Security tag-Monitoring tag-goss nav-closed">

    

    <div class="site-wrapper">

        


<header class="main-header post-head " style="background-image: url(/images/covers/cover-01.jpg)">
    <nav class="main-nav overlay clearfix">
        
    </nav>
</header>

<main class="content" role="main">
    <article class="post tag-Configuration-Management tag-Testing tag-Security tag-Monitoring tag-goss">

        <header class="post-header">
            <h1 class="post-title">Easy Infrastructure Testing with Goss</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2017-01-10">10 January 2017</time>  on <a href="http://www.pysysops.com/tag/Configuration-Management/">Configuration Management</a>, <a href="http://www.pysysops.com/tag/Testing/"> Testing</a>, <a href="http://www.pysysops.com/tag/Security/"> Security</a>, <a href="http://www.pysysops.com/tag/Monitoring/"> Monitoring</a>, <a href="http://www.pysysops.com/tag/goss/"> goss</a>
            </section>
        </header>

        <section class="post-content">
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In the world of infrastructure; new servers, VMs, containers or applications are often manually validated by a human. Some form of build document or checkbox exercise takes place to confirm that the piece of infrastructure is ready for use. Even with configuration management, mistakes happen and humans make mistakes (damn humans).</p>
</div>
<div class="paragraph">
<p>Wouldn&#8217;t it be great if there were an easy way to automatically validate new servers before they are live and we find the problems in production? Well, there is! Try <a href="https://github.com/aelsabbahy/goss">Goss</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_is_goss">What is Goss?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://github.com/aelsabbahy/goss">Goss</a> is a tool that let&#8217;s you easily and quickly validate infrastructure. Like <a href="http://serverspec.org/">Serverspec</a> but without all the code. Goss allows you to define what a piece of infrastructure should look like with YAML or JSON. This is made even easier for us with the ability to auto add resources to the Goss configuration on the command line.</p>
</div>
<div class="paragraph">
<p>Goss allows you to validate many different resource types such as files, users, groups, packages, services and http connectivity. You can read the full Goss documentation <a href="https://github.com/aelsabbahy/goss/blob/master/docs/manual.md#available-tests">here</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_goss">Why Goss?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Well, a few things make goss an awesome tool for server validation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Written in Go - This means it&#8217;s a self contained binary with no dependencies on other libraries or interpreters.</p>
</li>
<li>
<p>It&#8217;s super fast - Taking advantage of Go&#8217;s concurrency model: tests are executed and returned almost instantly.</p>
</li>
<li>
<p>It&#8217;s easy to get started with - Defining resources in YAML or JSON makes it easy for your entire team to get to grips with.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_an_example">An Example</h3>
<div class="paragraph">
<p>We build a web server running Apache.</p>
</div>
<div class="paragraph">
<p>Before going live someone checks that the Apache <code>httpd</code> package is the correct version of <code>2.4.25</code>, the <code>deployment</code> user is in the <code>www-data</code> group and there is an application directory at <code>/srv/www/app</code>. They also check the <code>httpd</code> service is running, we can connect to the application at <code><a href="http://localhost/app" class="bare">http://localhost/app</a></code> and going to <code><a href="http://localhost/" class="bare">http://localhost/</a></code> gives a <code>404</code> error page.</p>
</div>
<div class="paragraph">
<p>To automate the above procedure with Goss, the YAML configuration would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">---
package:
  httpd:
    installed: true
    versions:
    - 2.4.25
user:
  deployment:
    exists: true
    groups:
    - deployment
    - www-data
file:
  /srv/www/app:
    exists: true
    filetype: directory
service:
  httpd:
    enabled: true
    running: true
http:
  http://localhost/app:
    status: 200
    timeout: 1000
  http://localhost:
    status: 404
    timeout: 1000</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see clearly what is being validated and this goss.yaml file can be used to consistently validate all servers of the same configuration.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_server_validation_and_monitoring">Server Validation and Monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All this validation of files, processes, services, ports and connectiovity sounds familiar. It&#8217;s something that we quite often try to achieve with our monitoring tools like Nagios, Zabbix or Sensu.</p>
</div>
<div class="paragraph">
<p>With Goss we can create a single monitoring check that tests many resources at once. Goss has several different <a href="https://github.com/aelsabbahy/goss/#supported-output-formats">outputs</a>. The nagios_verbose output gives you out of the box testing compatible with Nagios or Sensu and gives Nagios long output explaining failures:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://cloud.githubusercontent.com/assets/1253072/18037748/76f65a32-6d83-11e6-9aba-bceabb8430a3.png" alt="Goss - nagios_verbose output">
</div>
</div>
<div class="paragraph">
<p>Server validation can now become part of your monitoring ecosystem ensuring that any problems are identified quickly with a single monitoring check.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Goss won&#8217;t replace all of your checks, it doesn&#8217;t check things like HDD space, RAM usage or errors in log files. But it makes a sweet addition to server / service monitoring.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_http_health_endpoint">HTTP Health Endpoint</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Many applications expose "health" endpoints for applications and services.</p>
</div>
<div class="paragraph">
<p>Tools like Google&#8217;s Borgmon monitoring system and <a href="https://prometheus.io/">Prometheus</a> use this HTTP(S) scrape or pull model to retrieve monitoring and metrics results from there services.</p>
</div>
<div class="paragraph">
<p>Goss has a <a href="https://github.com/aelsabbahy/goss/blob/master/docs/manual.md#serve-s---serve-a-health-endpoint"><code>serve</code> command</a> that exposes a http endpoint for scraping. You can then then use something like <a href="https://www.phpservermonitor.org/">PHP Server Monitor</a> to show the validation status of each piece of infrastructure.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If instrumeting your applications interests you, there&#8217;s plenty of libraries to assist you. Check out: <a href="http://metrics.dropwizard.io/3.1.0/">Dropwizard Metrics</a> and <a href="http://blog.kristian.io/django-health-check/">Django Health Check</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_final_thoughts">Final Thoughts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hopefully you can see the value of validation testing your infrastructure and building validation into your monitoring systems.</p>
</div>
<div class="paragraph">
<p>Goss is a young project and currently only supports Linux but it&#8217;s very active and open to contributions. You can help out by opening issues, discussing enhancements and submitting pull requests for review.</p>
</div>
<div class="paragraph">
<p>I&#8217;ll cover some advanced Goss usage in future posts. Thanks for reading!</p>
</div>
</div>
</div>
        </section>

        <footer class="post-footer">


            <figure class="author-image">
                <a class="img" href="http://www.pysysops.com/author/pysysops/" style="background-image: url(https://avatars.githubusercontent.com/u/1253072?v&#x3D;3)"><span class="hidden">Tim Birkett's Picture</span></a>
            </figure>

            <section class="author">
                <h4><a href="http://www.pysysops.com/author/pysysops/">Tim Birkett</a></h4>

                    <p>Read <a href="http://www.pysysops.com/author/pysysops/">more posts</a> by this author.</p>
                <div class="author-meta">
                    <span class="author-location icon-location">Manchester, United Kingdom</span>
                    <span class="author-link icon-link"><a href="www.pysysops.com">www.pysysops.com</a></span>
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/intent/tweet?text=Easy%20Infrastructure%20Testing%20with%20Goss&amp;url=http://www.pysysops.com/2017/01/10/Easy-Infrastructure-Testing-with-Goss.html"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://www.pysysops.com/2017/01/10/Easy-Infrastructure-Testing-with-Goss.html"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://www.pysysops.com/2017/01/10/Easy-Infrastructure-Testing-with-Goss.html"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>


        <section class="post-comments">
          <div id="disqus_thread"></div>
          <script type="text/javascript">
          var disqus_shortname = 'pysysops'; // required: replace example with your forum shortname
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </section>


    </article>

</main>

<aside class="read-next">
</aside>



        <footer class="site-footer clearfix">
            <section class="copyright"><a href="http://www.pysysops.com">Tim Birkett </a> &copy; 2017</section>
            <section class="poweredby">Proudly published with <a href="http://hubpress.io">HubPress</a></section>
        </footer>

    </div>

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();
      </script>

    <script type="text/javascript" src="//www.pysysops.com/themes/casper/assets/js/jquery.fitvids.js?v=1485532747783"></script>
    <script type="text/javascript" src="//www.pysysops.com/themes/casper/assets/js/index.js?v=1485532747783"></script>

    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-90121848-1', 'auto');
    ga('send', 'pageview');

    </script>
</body>
</html>
